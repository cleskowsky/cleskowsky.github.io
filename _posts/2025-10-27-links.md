---
layout: post
title: "Weekly notes"
---

* [Fixing UUIDv7 (for database use-cases)](https://brooker.co.za/blog/2025/10/22/uuidv7): Sometimes it makes sense to insert db records with primary keys that are increasing for quicker index adds and better spatial locality in terms of clustering data in close together on a disk page. UUID4 is randomly generated like a hash function. When we save data like that, retrieval can appear like random access to disk for range queries. UUID7 starts with a prefix based on a timestamp. There are security concerns about using timestamps around reducing entropy. (Measure of predictability of a soemthing like an id or a password.)
* [OAuth 2.0 Threat Model and Security Considerations](https://datatracker.ietf.org/doc/html/rfc6819): A threat model of the oauth 2 protocol for secure authentication / authorization between a client and server. Included in this thread model is a list of system components that are in scope, assumptions about a system setup, and a list of brainstormed potential attacks per component as well as suggested remediations and criticality of concern. This sort of thing takes time to produce and you get better results by having a group involved.
* [Threat model examples](https://github.com/hysnsec/awesome-threat-modelling?tab=readme-ov-file#threat-model-examples): This is a nice list of different models that can be used as examples.
* [Owasp Threat Modeling Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Threat_Modeling_Cheat_Sheet.html): Consice guide to how to think about this exercise, when to do it, and when to stop with pointers to deeper material.
* [How to approach threat modeling](https://aws.amazon.com/blogs/security/how-to-approach-threat-modeling/): Aws article with a high level overview of the phases of threat modelling and how to think about the exercise.
* [Simplify Your Code: Functional Core, Imperative Shell](https://www.youtube.com/watch?v=0vkY2H2QDC8): Short bit of advice about how to structure logic in the small which resonates a bit. Separating the control flow of a business transaction like this make testing easier.

```typescript
// Bad: Logic and side effects are mixed
function sendUserExpiryEmail(): void {
  for (const user of db.getUsers()) {
    if (user.subscriptionEndDate > Date.now()) continue;
    if (user.isFreeTrial) continue;
    email.send(user.email, "Your account has expired " + user.name + “.”);
  }
}

// Better
function getExpiredUsers(users: User[], cutoff: Date): User[] {
    return users.filter(user => user.subscriptionEndDate <= cutoff && !user.isFreeTrial);
}

function generateExpiryEmails(users: User[]): Array<[string, string]> {
    return users.map(user =>
        ([user.email, “Your account has expired “ +user.name + “.”])
    );
}

// and
email.bulkSend(generateExpiryEmails(getExpiredUsers(db.getUsers(), Date.now())));
```

* [How Discord Indexes Trillions of Messages](https://discord.com/blog/how-discord-indexes-trillions-of-messages): A large multitenant elasticsearch cluster is split up into smaller ones based on how much data should be indexed in a single cluster / primary shard. There is a consideration for very populer / busy discord communities that need special handling. (> 2bil messages to index get their very own elastic cluster) Painful learnings in here but sound understanding of system and usage that helped the team muddle through this ...
* [The Journey Before main()_](https://amit.prasad.me/blog/before-main): Talks about the entrypoint in the kernel to start a program that includes how an application binary is loading, interpreted and memory laid out initially before control is passed to main() in user space

# Goal of platform engineering

* [Platform Engineering: A Deep Dive Conversation • Russ Miles & Kevlin Henney • GOTO 2024](https://www.youtube.com/watch?v=0vkY2H2QDC8)

> When I'm thinking about a large, fundamental change, "What is the behavioural change we're looking for ...", "It's not a tools thing", "How do you empower a group of people to be better", "How do preserve trust in a group", "Not taking something away", "How to create confidence in making changes and taking risks by creating safety"

* Platform engineering "creates a space for people to live and work in"
* Want to preserve sense of ownership of an application / product in the product + development team
